{"ast":null,"code":"var _jsxFileName = \"/Users/jiangzilong/\\u5B66\\u4E60/minpg/Heptabase-Blog/src/page/Post.js\",\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { BrowserRouter as Router, Routes, Route, Link, useParams, useNavigate } from 'react-router-dom';\nimport { useLocation } from \"react-router\";\nimport Container from '../components/Container';\nimport Nav from '../components/Nav';\nimport Footer from '../components/Footer';\nimport '../index.css';\nimport 'github-markdown-css';\nimport { getHeptabaseData, getClearCard, getClearImag } from '../constantFunction';\nimport { id } from 'date-fns/locale';\n\n// 文章页面\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Post(props) {\n  _s2();\n  var _s = $RefreshSig$();\n  let {\n    slug\n  } = useParams();\n  // 记录当前文章对应的卡片信息\n  let [card, setCard] = useState(null);\n  // 记录数据加载状态\n  let [isLoading, setLoadingState] = useState(true);\n  console.log(slug);\n  console.log(window.location);\n\n  // window.location = window.location+'&note-id=b81a2f54-ec5b-4de0-9e97-ab841c0e18f9'\n  console.log(window.location);\n\n  // 获取 URL 参数\n  let url_search = window.location.search;\n  url_search = url_search.replace('?', '');\n  let url_search_list = url_search.split('note-id=');\n  const useScrollToTop = () => {\n    _s();\n    //注意自定义Hooks要用useXXX定义\n    const {\n      pathname\n    } = useLocation();\n    useEffect(() => {\n      console.log('useScrollToTop');\n      console.log(window.history);\n      window.history.scrollRestoration = 'manual';\n\n      // 根据跳转类型来决定是否要定位到顶部，如果不是点击 span 或 backLink 则不回到顶部\n\n      let nav_type = sessionStorage.getItem('nav_type');\n      if (nav_type > -1) {\n        // 点击了 span 或 backLink\n\n        setTimeout(() => {\n          window.scrollTo({\n            top: 0,\n            left: 0,\n            behavior: 'auto'\n          });\n        }, 10);\n\n        // window.scrollTo(0, 0);\n\n        // 重置 nav_type\n        sessionStorage.setItem('nav_type', -1);\n      } else {\n        // 返回上一页\n        setTimeout(() => {\n          window.scrollTo({\n            top: sessionStorage.getItem('scrollY'),\n            left: 0,\n            behavior: 'auto'\n          });\n\n          // window.scrollTo(0, sessionStorage.getItem('scrollY'));\n        }, 10);\n\n        // window.scrollTo(0, sessionStorage.getItem('scrollY'));\n      }\n    }, [pathname]);\n  };\n  _s(useScrollToTop, \"+8VPq4+XDMjo/kjL3WLkbwU2Amg=\", false, function () {\n    return [useLocation];\n  });\n  useScrollToTop();\n  // useReStoreScrollTop();\n\n  useEffect(() => {\n    // console.log('scrollTo(0, 0)');\n    // window.scrollTo(0, 0);\n    console.log('Post useEffect');\n    // 根据 URL 参数加载数据\n    for (let i = 0; i < url_search_list.length; i++) {\n      if (url_search_list[i] == '') {\n        continue;\n      }\n      setContent(url_search_list[i]);\n    }\n\n    // \n  });\n\n  // 获取文章数据、处理文章数据\n  const setContent = id => {\n    console.log('setContent');\n\n    // 如果已经获取过数据，则直接从获取的数据中提取\n    if (card == null) {\n      // 存储数据的变量\n      let heptabase_blog_data;\n      getHeptabaseData.then(res => {\n        heptabase_blog_data = res.data;\n        setCard(heptabase_blog_data);\n        let new_card = findContent(id, heptabase_blog_data);\n\n        // 404\n        if (new_card == null) {\n          console.log('404');\n          window.location = '/404';\n        } else {\n          return new_card;\n        }\n      });\n    } else {\n      // 已经有数据了\n      console.log(card);\n      let new_card = findContent(id, card);\n\n      // 404\n      if (new_card == null) {\n        console.log('404');\n        window.location = '/404';\n      } else {\n        return new_card;\n      }\n    }\n  };\n  const findContent = (id, heptabase_blog_data) => {\n    console.log('Container setContent for:');\n    for (let i = 0; i < heptabase_blog_data.cards.length; i++) {\n      if (heptabase_blog_data.cards[i]['id'] == id) {\n        // 处理内容中的图片\n        heptabase_blog_data.cards[i] = getClearImag(heptabase_blog_data.cards[i]);\n        console.log('getClearImag done');\n        // 处理内容中的链接\n        new_card = getClearCard(heptabase_blog_data.cards[i], heptabase_blog_data.cards);\n        heptabase_blog_data.cards[i] = new_card['card'];\n\n        // 设置网页标题\n        if (new_card['card']['title'] !== 'About') {\n          document.title = new_card['card']['title'];\n        } else {\n          document.title = 'Jiang 的数字花园🌱';\n        }\n        return new_card;\n      }\n    }\n    return null;\n  };\n\n  // 根据 URL 路径加载数据\n\n  if (card == null) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"loading\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 16\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(Nav, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Container, {\n          card: card\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 16\n    }, this);\n  }\n}\n_s2(Post, \"96sADa/D/WncKBOA1cfa1hfGryI=\", false, function () {\n  return [useParams, useScrollToTop];\n});\n_c = Post;\nexport default Post;\nvar _c;\n$RefreshReg$(_c, \"Post\");","map":{"version":3,"names":["React","useState","useEffect","useRef","BrowserRouter","Router","Routes","Route","Link","useParams","useNavigate","useLocation","Container","Nav","Footer","getHeptabaseData","getClearCard","getClearImag","id","Post","props","slug","card","setCard","isLoading","setLoadingState","console","log","window","location","url_search","search","replace","url_search_list","split","useScrollToTop","pathname","history","scrollRestoration","nav_type","sessionStorage","getItem","setTimeout","scrollTo","top","left","behavior","setItem","i","length","setContent","heptabase_blog_data","then","res","data","new_card","findContent","cards","document","title"],"sources":["/Users/jiangzilong/学习/minpg/Heptabase-Blog/src/page/Post.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { BrowserRouter as Router, Routes, Route, Link, useParams, useNavigate } from 'react-router-dom';\nimport { useLocation } from \"react-router\";\n\nimport Container from '../components/Container'\nimport Nav from '../components/Nav';\nimport Footer from '../components/Footer'\n\nimport '../index.css'\nimport 'github-markdown-css'\n\nimport { getHeptabaseData, getClearCard, getClearImag } from '../constantFunction'\nimport { id } from 'date-fns/locale';\n\n// 文章页面\nfunction Post(props) {\n    let { slug } = useParams();\n    // 记录当前文章对应的卡片信息\n    let [card, setCard] = useState(null);\n    // 记录数据加载状态\n    let [isLoading, setLoadingState] = useState(true)\n\n    console.log(slug);\n    console.log(window.location);\n\n    // window.location = window.location+'&note-id=b81a2f54-ec5b-4de0-9e97-ab841c0e18f9'\n    console.log(window.location);\n\n    // 获取 URL 参数\n    let url_search = window.location.search\n    url_search = url_search.replace('?', '')\n    let url_search_list = url_search.split('note-id=')\n\n    const useScrollToTop = () => {   //注意自定义Hooks要用useXXX定义\n        const { pathname } = useLocation();\n        useEffect(() => {\n\n            console.log('useScrollToTop');\n\n            console.log(window.history);\n            window.history.scrollRestoration = 'manual';\n\n            // 根据跳转类型来决定是否要定位到顶部，如果不是点击 span 或 backLink 则不回到顶部\n\n            let nav_type = sessionStorage.getItem('nav_type')\n\n            if (nav_type > -1) {\n                // 点击了 span 或 backLink\n\n                setTimeout(() => {\n                    window.scrollTo({\n                        top: 0,\n                        left: 0,\n                        behavior: 'auto'\n                    });\n                }, 10);\n\n                // window.scrollTo(0, 0);\n\n                // 重置 nav_type\n                sessionStorage.setItem('nav_type', -1)\n            } else {\n\n                // 返回上一页\n                setTimeout(() => {\n\n                    window.scrollTo({\n                        top: sessionStorage.getItem('scrollY'),\n                        left: 0,\n                        behavior: 'auto'\n                    });\n\n                    // window.scrollTo(0, sessionStorage.getItem('scrollY'));\n\n                }, 10);\n\n                // window.scrollTo(0, sessionStorage.getItem('scrollY'));\n\n\n            }\n\n\n        }, [pathname]);\n    }\n\n    useScrollToTop();\n    // useReStoreScrollTop();\n\n    useEffect(() => {\n        // console.log('scrollTo(0, 0)');\n        // window.scrollTo(0, 0);\n        console.log('Post useEffect');\n        // 根据 URL 参数加载数据\n        for (let i = 0; i < url_search_list.length; i++) {\n            if(url_search_list[i]==''){\n                continue\n            }\n            setContent(url_search_list[i])\n        }\n\n        // \n\n    })\n\n    // 获取文章数据、处理文章数据\n    const setContent = (id) => {\n        console.log('setContent');\n\n        // 如果已经获取过数据，则直接从获取的数据中提取\n        if (card == null) {\n            // 存储数据的变量\n            let heptabase_blog_data\n\n            getHeptabaseData.then((res) => {\n                heptabase_blog_data = res.data\n\n                setCard(heptabase_blog_data)\n\n                let new_card = findContent(id, heptabase_blog_data)\n\n                // 404\n                if (new_card == null) {\n                    console.log('404');\n                    window.location = '/404'\n                } else {\n\n                    return new_card\n                }\n\n            })\n        } else {\n            // 已经有数据了\n            console.log(card);\n            let new_card = findContent(id, card)\n\n            // 404\n            if (new_card == null) {\n                console.log('404');\n                window.location = '/404'\n            } else {\n\n                return new_card\n            }\n        }\n\n\n\n    }\n\n\n    const findContent = (id, heptabase_blog_data) => {\n\n        console.log('Container setContent for:');\n        for (let i = 0; i < heptabase_blog_data.cards.length; i++) {\n\n            if (heptabase_blog_data.cards[i]['id'] == id) {\n\n                // 处理内容中的图片\n                heptabase_blog_data.cards[i] = getClearImag(heptabase_blog_data.cards[i])\n                console.log('getClearImag done');\n                // 处理内容中的链接\n                new_card = getClearCard(heptabase_blog_data.cards[i], heptabase_blog_data.cards)\n                heptabase_blog_data.cards[i] = new_card['card']\n\n                // 设置网页标题\n                if (new_card['card']['title'] !== 'About') {\n                    document.title = new_card['card']['title']\n                } else {\n                    document.title = 'Jiang 的数字花园🌱'\n                }\n\n                return new_card\n\n            }\n        }\n\n        return null\n\n    }\n\n    // 根据 URL 路径加载数据\n\n\n    if (card == null) {\n        return <div>loading</div>\n    } else {\n        return <div>\n\n            <div>\n                <Nav />\n                <Container card={card} />\n                <Footer />\n            </div>\n        </div>;\n    }\n\n\n}\n\nexport default Post;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}